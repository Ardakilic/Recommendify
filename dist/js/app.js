var searchForm=$("#searchform"),input=$('input[name="username"]'),result=$(".search-result"),select=$('select[name="method"]');const corsProxy="https://crossorigin.me/",endpoints={recommendation:"http://www.last.fm/player/station/user/[INPUT]/recommended?ajax=1",mix:"http://www.last.fm/player/station/user/[INPUT]/mix?ajax=1",library:"http://www.last.fm/player/station/user/[INPUT]/library?ajax=1",artist:"http://www.last.fm/player/station/music/[INPUT]?ajax=1",tag:"http://www.last.fm/player/station/tag/[INPUT]?ajax=1"};searchForm.submit(function(t){t.preventDefault(),hideContainers(),$.getJSON(corsProxy+endpoints[select.val()].replace("[INPUT]",encodeURIComponent(input.val()))).done(process).fail(function(){$("#error-message").html("<p>Error fetching your data. This may be due wrong username or api connection error.</p><p>Please refresh the page and try again</p>").show(),$("#message-container").fadeIn("fast")})});var timer;input.on("keyup",function(){clearTimeout(timer),timer=setTimeout(function(){input.val().length>2&&searchForm.submit()},500)}),input.on("keydown",function(){clearTimeout(timer)}),result.click(function(){result.select()});var process=function(t){for(var e=[],a=0;a<t.playlist.length;a++)for(var r=!1,n=0;n<t.playlist[a].playlinks.length;n++)if("spotify"==t.playlist[a].playlinks[n].affiliate){e.push(t.playlist[a].playlinks[n].id),r=!0;break}$("#result-link").attr("href","spotify:trackset:Playlist:"+e.join(",")),$("#result-textarea").val($.map(e,function(t,e){return"spotify:track:"+t}).join("\n")),$("#result-container").fadeIn("fast")},hideContainers=function(){$('div[rel="alert"], div[rel="container"]').hide()};