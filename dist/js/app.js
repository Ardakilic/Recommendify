const searchForm=$("#searchform"),input=$('input[name="username"]'),result=$(".search-result"),select=$('select[name="method"]'),endpoints={recommendation:"http://www.last.fm/player/station/user/[INPUT]/recommended?ajax=1",mix:"http://www.last.fm/player/station/user/[INPUT]/mix?ajax=1",library:"http://www.last.fm/player/station/user/[INPUT]/library?ajax=1",artist:"http://www.last.fm/player/station/music/[INPUT]?ajax=1",tag:"http://www.last.fm/player/station/tag/[INPUT]?ajax=1"},process=e=>{const t=e.playlist.map(e=>e.playlinks.filter(e=>"spotify"===e.affiliate).map(e=>e.id));$("#result-iframe").attr("src",`https://embed.spotify.com/?uri=spotify:trackset:Recommendify:${t.join(",")}`).load(),$("#result-link-trackset").attr("href",`spotify:trackset:Recommendify:${t.join(",")}`),$("#result-link-openplayer").attr("href",`https://open.spotify.com/trackset/Recommendify/${t.join(",")}`),$("#result-textarea").val($.map(t,e=>`spotify:track:${e}`).join("\n")),$("#result-container").fadeIn("fast")},hideContainers=()=>{$('div[rel="alert"], div[rel="container"]').hide()};let timer;searchForm.submit(e=>{e.preventDefault(),$('div[rel="alert"], div[rel="container"]').hide(),$.getJSON(endpoints[select.val()].replace("[INPUT]",encodeURIComponent(input.val()))).done(process).fail(()=>{$("#error-message").html("<p>Error fetching your data. This may be due wrong username or api connection error.</p><p>Please refresh the page and try again</p>").show(),$("#message-container").fadeIn("fast")})}),input.on("keyup",()=>{clearTimeout(timer),timer=setTimeout(()=>{input.val().length>2&&searchForm.submit()},500)}),input.on("keydown",()=>{clearTimeout(timer)}),result.click(()=>{result.select()});